# Analysis of genomic amplicon sequencing with CRISPResso2
# (Bash shell on macOS)



# ---------------------------
# CRISPResso installation
# ---------------------------

# Install CRISPResso through conda as described here: https://github.com/pinellolab/CRISPResso2
# (Couldn't run CRISPResso through website because fastqs are bigger than 100 MB)

conda config --add channels defaults
conda config --add channels bioconda
conda config --add channels conda-forge
conda create -n crispresso2_env -c bioconda crispresso2 python=2.7

# Run this to get latest version of samtools
conda install samtools



# ---------------------------
# CRISPResso analysis (conda)
# ---------------------------

# The installation code above creates an environment to run CRISPResso2
# First, activate this environment and check if it is working
conda info --envs
conda activate crispresso2_env
CRISPResso -h


# Run the following commands (each line is for a different amplicon)
CRISPResso --fastq_r1 data/BE02_Pool2_S2_L001_R1_001.fastq --fastq_r2 data/BE02_Pool2_S2_L001_R2_001.fastq --amplicon_seq AGACGCCGACATAGAGGAGAAGCATATGTACAATGAGCCGGTCACAACCCTCTTTCACGACGTTGAAGCTTCACAAACACACCACAGACGTGGGTCAATACCATTGAAAGATGAGAAAAGTAAAGAATTGTATCCATTGCGCTCTTTCCCGACGAGAGTAAATGGCGAGGATACGTTCTCTATGGAGGATGGCATAGGTGATGAAGATGAAGGAGAAGTACAGAACGCTGAAGTGAAGAGAGAGCTTAAGCAAAGACATATTGGTATGATTGCCCTTGG --guide_seq GATACGTTCTCTATGGAGGA --min_average_read_quality 30 --quantification_window_size 20 --quantification_window_center -10 --base_editor_output --output_folder pLK78
CRISPResso --fastq_r1 data/BE02_Pool2_S2_L001_R1_001.fastq --fastq_r2 data/BE02_Pool2_S2_L001_R2_001.fastq --amplicon_seq TTGGTATGATTGCCCTTGGTGGTACTATTGGTACAGGTCTTTTCATTGGTTTATCCACACCTCTGACCAACGCCGGCCCAGTGGGCGCTCTTATATCATATTTATTTATGGGTTCTTTGGCATATTCTGTCACGCAGTCCTTGGGTGAAATGGCTACATTCATCCCTGTTACATCCTCTTTCACAGTTTTCTCACAAAGATTCCTTTCTCCAGCATTTGGTGCGGCCAATGGTTACATGTATTGGTTTTCTTGGGCAATCACTTTTGCCCTGGAACT --guide_seq AAACCAATACATGTAACCAT --min_average_read_quality 30 --quantification_window_size 20 --quantification_window_center -10 --base_editor_output --output_folder pOS08
CRISPResso --fastq_r1 data/BE02_Pool2_S2_L001_R1_001.fastq --fastq_r2 data/BE02_Pool2_S2_L001_R2_001.fastq --amplicon_seq TCACTTTTGCCCTGGAACTTAGTGTAGTTGGCCAAGTCATTCAATTTTGGACGTACAAAGTTCCACTGGCGGCATGGATTAGTATTTTTTGGGTAATTATCACAATAATGAACTTGTTCCCTGTCAAATATTACGGTGAATTCGAGTTCTGGGTCGCTTCCATCAAAGTTTTAGCCATTATCGGGTTTCTAATATACTGTTTTTGTATGGTTTGTGGTGCTGGGGTTACCGGCCCAGTTGGATTCCGTTATTGGAGAAACCCAGGTGC --guide_seq ACGTCCAAAATTGAATGACT --min_average_read_quality 30 --quantification_window_size 20 --quantification_window_center -10 --base_editor_output --output_folder pOS09
CRISPResso --fastq_r1 data/BE02_Pool2_S2_L001_R1_001.fastq --fastq_r2 data/BE02_Pool2_S2_L001_R2_001.fastq --amplicon_seq GTTTGTGGTGCTGGGGTTACCGGCCCAGTTGGATTCCGTTATTGGAGAAACCCAGGTGCCTGGGGTCCAGGTATAATATCTAAGGATAAAAACGAAGGGAGGTTCTTAGGTTGGGTTTCCTCTTTGATTAACGCTGCCTTCACATTTCAAGGTACTGAACTAGTTGGTATCACTGCTGGTGAAGCTGCAAACCCCAGAAAATCCGTTCCAAGA --guide_seq CTCCAATAACGGAATCCAAC --min_average_read_quality 30 --quantification_window_size 20 --quantification_window_center -10 --base_editor_output --output_folder pOS10
CRISPResso --fastq_r1 data/BE02_Pool2_S2_L001_R1_001.fastq --fastq_r2 data/BE02_Pool2_S2_L001_R2_001.fastq --amplicon_seq TGCTGTTTGTTGCTACGGATCGTATCTCTGCATATGACGTTATTATGGAAAACAGCATTCCTGAAAAGGGGATCCTATTGACCAAACTGTCAGAGTTCTGGTTCAAGTTCCTGTCCAACGATGTTCGTAATCATTTGGTCGACATCGCCCCAGGTAAGACTATTTTCGATTATCTACCTGCAAAATTGAGCGAACCAAAGTACAAAACGCAACTAGAAGACCGCTCTC --guide_seq GAACCAGAACTCTGACAGTT --min_average_read_quality 30 --quantification_window_size 20 --quantification_window_center -10 --base_editor_output --output_folder pOS11
CRISPResso --fastq_r1 data/BE02_Pool2_S2_L001_R1_001.fastq --fastq_r2 data/BE02_Pool2_S2_L001_R2_001.fastq --amplicon_seq TCCCAGAACCAATCTTCACCCCATCGACCAAGGCTGAACAAGGTGAACATGACGAAAACATCTCTCCTGCCCAGGCCGCTGAGCTGGTGGGTGAAGATTTGTCACGTAGAGTGGCAGAACTGGCTGTAAAACTGTACTCCAAGTGCAAAGATTATGCTAAGGAGAAGGGCATCATCATCGCAGACACTAAATTCGAATTCGGTATTGACGAAAAGACCAATGAAATTATTCTAGTGGACGAGGTGCTAACGCCAGACTCCTCTA --guide_seq TCCTGCCCAGGCCGCTGAGC --min_average_read_quality 30 --quantification_window_size 20 --quantification_window_center -10 --base_editor_output --output_folder pOS12
CRISPResso --fastq_r1 data/BE02_Pool2_S2_L001_R1_001.fastq --fastq_r2 data/BE02_Pool2_S2_L001_R2_001.fastq --amplicon_seq CCAATGACCACGTTAATGGCTCCTTTTCCAATCCTCTTGATATCGAAAAACTAGCTGAAAAATGTGATGTGCTAACGATTGAGATTGAGCATGTTGATGTTCCTACACTAAAGAATCTTCAAGTAAAACATCCCAAATTAAAAATTTACCCTTCTCCAGAAACAATCAGATTGATACAAGACAAATATATTCAAAAAGAGCATTTAATCAAAAATGGTATAGCAGTTACCCAAAGTGTTCCTGTGGAACAAGCCAGTGAGACGTCCCTATTGA --guide_seq AGTTACCCAAAGTGTTCCTG --min_average_read_quality 30 --quantification_window_size 20 --quantification_window_center -10 --base_editor_output --output_folder pOS13
CRISPResso --fastq_r1 data/BE02_Pool2_S2_L001_R1_001.fastq --fastq_r2 data/BE02_Pool2_S2_L001_R2_001.fastq --amplicon_seq CGAGGACTTTGGCATACGATGGAAGAGGTAACTTCGTTGTAAAGAATAAGGAAATGATTCCGGAAGCTTTGGAAGTACTGAAGGATCGTCCTTTGTACGCCGAAAAATGGGCACCATTTACTAAAGAATTAGCAGTCATGATTGTGAGATCTGTTAACGGTTTAGTGTTTTCTTACCCAATTGTAGAGACTATCCACAAGGACAATATTTGTGACTTATGTTATGCGCCTGCTAGAGTTCCGGACTCCGTTCAACTTAAGGCG --guide_seq GCCCATTTTTCGGCGTACAA --min_average_read_quality 30 --quantification_window_size 20 --quantification_window_center -10 --base_editor_output --output_folder pOS14



# ---------------------------
# Sequences for reference
# ---------------------------

# gRNAs:
# GATACGTTCTCTATGGAGGA
# AAACCAATACATGTAACCAT
# ACGTCCAAAATTGAATGACT
# CTCCAATAACGGAATCCAAC
# GAACCAGAACTCTGACAGTT
# TCCTGCCCAGGCCGCTGAGC
# AGTTACCCAAAGTGTTCCTG
# GCCCATTTTTCGGCGTACAA

# Amplicons:
# AGACGCCGACATAGAGGAGAAGCATATGTACAATGAGCCGGTCACAACCCTCTTTCACGACGTTGAAGCTTCACAAACACACCACAGACGTGGGTCAATACCATTGAAAGATGAGAAAAGTAAAGAATTGTATCCATTGCGCTCTTTCCCGACGAGAGTAAATGGCGAGGATACGTTCTCTATGGAGGATGGCATAGGTGATGAAGATGAAGGAGAAGTACAGAACGCTGAAGTGAAGAGAGAGCTTAAGCAAAGACATATTGGTATGATTGCCCTTGG
# TTGGTATGATTGCCCTTGGTGGTACTATTGGTACAGGTCTTTTCATTGGTTTATCCACACCTCTGACCAACGCCGGCCCAGTGGGCGCTCTTATATCATATTTATTTATGGGTTCTTTGGCATATTCTGTCACGCAGTCCTTGGGTGAAATGGCTACATTCATCCCTGTTACATCCTCTTTCACAGTTTTCTCACAAAGATTCCTTTCTCCAGCATTTGGTGCGGCCAATGGTTACATGTATTGGTTTTCTTGGGCAATCACTTTTGCCCTGGAACT
# TCACTTTTGCCCTGGAACTTAGTGTAGTTGGCCAAGTCATTCAATTTTGGACGTACAAAGTTCCACTGGCGGCATGGATTAGTATTTTTTGGGTAATTATCACAATAATGAACTTGTTCCCTGTCAAATATTACGGTGAATTCGAGTTCTGGGTCGCTTCCATCAAAGTTTTAGCCATTATCGGGTTTCTAATATACTGTTTTTGTATGGTTTGTGGTGCTGGGGTTACCGGCCCAGTTGGATTCCGTTATTGGAGAAACCCAGGTGC
# GTTTGTGGTGCTGGGGTTACCGGCCCAGTTGGATTCCGTTATTGGAGAAACCCAGGTGCCTGGGGTCCAGGTATAATATCTAAGGATAAAAACGAAGGGAGGTTCTTAGGTTGGGTTTCCTCTTTGATTAACGCTGCCTTCACATTTCAAGGTACTGAACTAGTTGGTATCACTGCTGGTGAAGCTGCAAACCCCAGAAAATCCGTTCCAAGA
# TGCTGTTTGTTGCTACGGATCGTATCTCTGCATATGACGTTATTATGGAAAACAGCATTCCTGAAAAGGGGATCCTATTGACCAAACTGTCAGAGTTCTGGTTCAAGTTCCTGTCCAACGATGTTCGTAATCATTTGGTCGACATCGCCCCAGGTAAGACTATTTTCGATTATCTACCTGCAAAATTGAGCGAACCAAAGTACAAAACGCAACTAGAAGACCGCTCTC
# TCCCAGAACCAATCTTCACCCCATCGACCAAGGCTGAACAAGGTGAACATGACGAAAACATCTCTCCTGCCCAGGCCGCTGAGCTGGTGGGTGAAGATTTGTCACGTAGAGTGGCAGAACTGGCTGTAAAACTGTACTCCAAGTGCAAAGATTATGCTAAGGAGAAGGGCATCATCATCGCAGACACTAAATTCGAATTCGGTATTGACGAAAAGACCAATGAAATTATTCTAGTGGACGAGGTGCTAACGCCAGACTCCTCTA
# CCAATGACCACGTTAATGGCTCCTTTTCCAATCCTCTTGATATCGAAAAACTAGCTGAAAAATGTGATGTGCTAACGATTGAGATTGAGCATGTTGATGTTCCTACACTAAAGAATCTTCAAGTAAAACATCCCAAATTAAAAATTTACCCTTCTCCAGAAACAATCAGATTGATACAAGACAAATATATTCAAAAAGAGCATTTAATCAAAAATGGTATAGCAGTTACCCAAAGTGTTCCTGTGGAACAAGCCAGTGAGACGTCCCTATTGA
# CGAGGACTTTGGCATACGATGGAAGAGGTAACTTCGTTGTAAAGAATAAGGAAATGATTCCGGAAGCTTTGGAAGTACTGAAGGATCGTCCTTTGTACGCCGAAAAATGGGCACCATTTACTAAAGAATTAGCAGTCATGATTGTGAGATCTGTTAACGGTTTAGTGTTTTCTTACCCAATTGTAGAGACTATCCACAAGGACAATATTTGTGACTTATGTTATGCGCCTGCTAGAGTTCCGGACTCCGTTCAACTTAAGGCG
